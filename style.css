/* =============================
   DARK MODE
============================= */
function toggleDarkMode() {
    document.body.classList.toggle("dark");
}

/* =============================
   LIGHTBOX OPEN / CLOSE
============================= */
function openLightbox(src) {
    const lb = document.getElementById("lightbox");
    const img = document.getElementById("lightboxImg");

    img.src = src;
    lb.classList.add("open");

    // Store original & UV pair if available
    lb.dataset.original = src;
}

function closeLightbox() {
    const lb = document.getElementById("lightbox");
    lb.classList.remove("open");
}

/* =============================
   UV SWAP IN GALLERY + LIGHTBOX
============================= */
document.querySelectorAll(".uv-pair").forEach(card => {
    const imgs = JSON.parse(card.dataset.images);
    let index = 0;
    const img = card.querySelector(".swap-img");

    // preload UV
    const preload = new Image();
    preload.src = imgs[1];

    // click → swap UV in gallery
    img.addEventListener("click", (e) => {
        e.stopPropagation();
        swapGalleryUV();
        openLightbox(img.src);
    });

    // swipe → swap UV
    let startX = 0;
    img.addEventListener("touchstart", e => startX = e.touches[0].clientX);
    img.addEventListener("touchend", e => {
        if (Math.abs(e.changedTouches[0].clientX - startX) > 40) {
            swapGalleryUV();
        }
    });

    function swapGalleryUV() {
        img.classList.add("fade");
        setTimeout(() => {
            index = (index + 1) % imgs.length;
            img.src = imgs[index];
            img.classList.remove("fade");

            // Sync lightbox too
            const lb = document.getElementById("lightboxImg");
            lb.src = imgs[index];
        }, 180);
    }
});

/* =============================
   SWAP UV IN LIGHTBOX
============================= */
document.getElementById("lightboxImg").addEventListener("click", function(e) {
    e.stopPropagation();

    const current = this.src;

    // Find pair that matches this image
    const pair = [...document.querySelectorAll(".uv-pair")].find(p => {
        const imgs = JSON.parse(p.dataset.images);
        return imgs.includes(current);
    });

    if (!pair) return;

    const imgs = JSON.parse(pair.dataset.images);
    let index = imgs.indexOf(current);

    index = (index + 1) % imgs.length;

    // fade UV transition
    this.classList.add("fade");
    setTimeout(() => {
        this.src = imgs[index];
        this.classList.remove("fade");
    }, 180);
});
